<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MyDrive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-r from-indigo-100 to-purple-100 text-gray-800 min-h-screen flex">

    <!-- Sidebar -->
    <aside class="w-64 bg-white/90 backdrop-blur-sm shadow-2xl rounded-tr-3xl rounded-br-3xl p-6 flex flex-col justify-between">
        <div>
            <h1 class="text-3xl font-extrabold mb-10 text-purple-700 tracking-wide">📁 MyDrive</h1>
            <nav class="space-y-4">
                <a href="{{ url_for('main.index') }}" class="flex items-center space-x-3 text-indigo-600 font-semibold hover:text-indigo-900 transition">
                    <span>📄</span><span>All Files</span>
                </a>
                <a href="{{ url_for('main.index', favorites='true') }}" class="flex items-center space-x-3 text-yellow-600 font-semibold hover:text-yellow-800 transition">
                    <span>⭐</span><span>Favorites</span>
                </a>
                <a href="{{ url_for('main.shared') }}" class="flex items-center space-x-3 text-pink-500 font-semibold hover:text-pink-700 transition">
                    <span>🔗</span><span>Shared</span>
                </a>
                <a href="{{ url_for('main.trash') }}" class="flex items-center space-x-3 text-red-500 font-semibold hover:text-red-700 transition">
                    <span>🗑️</span><span>Trash</span>
                </a>
            </nav>
        </div>
        <div class="border-t pt-5 mt-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-11 h-11 bg-gradient-to-tr from-orange-500 to-yellow-400 rounded-full flex items-center justify-center text-white text-lg font-bold shadow">
                    {{ current_user.username[0] }}
                </div>
                <div>
                    <div class="font-bold text-sm">{{ current_user.username }}</div>
                    <div class="text-xs text-gray-500">{{ current_user.email }}</div>
                </div>
            </div>
            <a href="{{ url_for('auth.logout') }}" class="block text-center px-4 py-2 bg-red-500 text-white font-semibold rounded-lg shadow hover:bg-red-600 transition">Logout</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-10 overflow-y-auto">

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="bg-green-100 border-l-4 border-green-600 text-green-800 p-4 mb-6 rounded-lg shadow-md font-medium">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Upload Form -->
        <div class="bg-white/90 backdrop-blur-md border border-gray-200 rounded-2xl shadow-lg p-6 mb-10">
            <form class="grid grid-cols-1 md:grid-cols-4 gap-4" action="{{ url_for('main.upload') }}" method="POST" enctype="multipart/form-data">
                <input type="file" name="file" class="p-3 border border-indigo-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-400" required>
                <input type="text" name="folder" placeholder="Folder (optional)" class="p-3 border border-purple-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-400">
                <input type="text" name="description" placeholder="Description (optional)" class="p-3 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
                <button type="submit" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold px-4 py-2 rounded-md hover:from-green-600 hover:to-emerald-700 transition shadow-md">Upload</button>
            </form>
        </div>

        <!-- File Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8">
            {% for file in files %}
            <div class="bg-white/80 rounded-3xl shadow-xl p-6 text-center hover:shadow-2xl transition duration-200">
                <div class="text-6xl mb-3">
                    {% if file['type'].startswith('folder') %} 📁 {% else %} 📄 {% endif %}
                </div>
                <div class="font-bold text-lg truncate text-indigo-700">{{ file['filename'] }}</div>
                <div class="text-sm text-gray-500 mb-1">{{ file['upload_time'].strftime('%Y-%m-%d %H:%M') }}</div>
                <div class="text-xs text-gray-400 italic mb-2 truncate">{{ file['description'] or "No description" }}</div>

                {% if file.shared_to %}
                    <div class="text-xs text-pink-600 mb-2">
                        Shared to:
                        {% if file.shared_to is string %}
                            {{ file.shared_to }}
                        {% else %}
                            {{ file.shared_to | join(', ') }}
                        {% endif %}
                    </div>
                {% endif %}

                <div class="flex flex-wrap justify-center gap-2 mt-4">
                    <a href="{{ url_for('main.download', file_id=file._id) }}" class="bg-blue-600 text-white px-4 py-1.5 rounded-full text-sm hover:bg-blue-700 shadow transition">Download</a>

                    <a href="{{ url_for('main.favorite', file_id=file._id) }}"
                       class="px-4 py-1.5 rounded-full text-sm font-bold transition shadow 
                              {{ 'bg-yellow-500 text-white' if file.favorite else 'bg-gray-200 text-gray-800 hover:bg-gray-300' }}">
                        {% if file.favorite %}★{% else %}☆{% endif %}
                    </a>

                    <a href="{{ url_for('main.delete', file_id=file._id) }}" class="bg-red-500 text-white px-4 py-1.5 rounded-full text-sm hover:bg-red-600 shadow transition">Trash</a>

                    <form action="{{ url_for('main.share', file_id=file._id) }}" method="POST" onsubmit="return promptEmail(this);">
                        <input type="hidden" name="email" id="emailInput-{{ file._id }}">
                        <button type="submit" class="bg-yellow-500 text-white px-4 py-1.5 rounded-full text-sm hover:bg-yellow-600 shadow transition">Share</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <!-- Email prompt script -->
    <script>
        function promptEmail(form) {
            const email = prompt("Enter the email address to share this file with:");
            if (email) {
                form.querySelector('input[type="hidden"]').value = email;
                return true;
            }
            return false;
        }
    </script>
</body>
</html>
